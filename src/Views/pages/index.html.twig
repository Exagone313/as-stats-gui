{% extends "base/base.html.twig" %}
{% import "macros/macros.html.twig" as macro %}

{% block refresh %}
{% endblock %}

{% block title %}
{% endblock %}

{% block css %}
{% endblock %}

{% block content_wrapper %}
  {% set title = "Top #{ntop} AS" %}
  {% set label = "(#{label})" %}
  {{ macro.content_header(title, label, config.outispositive ) }}
{% endblock %}

{% set counter = 0 %}

{% if config.showv6 %}
  {% set first_col = "1" %}
  {% set second_col = "11" %}
  {% set offset_second_col = "0" %}
{% else %}
  {% set first_col = "2" %}
  {% set second_col = "9" %}
  {% set offset_second_col = "1" %}
{% endif %}

{% set legend %}
  <table class='small'>
    {% for link in knownlinks %}
      {% set tag = "link_#{ link.tag }" %}
      {% if request[tag] is defined and request[tag] == 'on' %}
        {% set checked = 'checked' %}
      {% else %}
        {% set checked = '' %}
      {% endif %}
      <tr><td style="border: 4px solid #fff;">
        <table style="border-collapse: collapse; margin: 0; padding: 0"><tr>
          {% if config.brighten_negative %}
            <td width="9" height="18" style="background-color: #{{ link.color }}">&nbsp;</td>
            <td width="9" height="18" style="opacity: 0.73; background-color: #{{ link.color }}">&nbsp;</td>
          {% else %}
            <td width="18" height="18" style="background-color: #{{ link.color }}">&nbsp;</td>
          {% endif %}
        </tr></table>
        </td><td>&nbsp; {{ link.descr }}</td>
        <td>&nbsp;<input type='checkbox' name='{{ tag }}' id ='{{ tag }}' {{ checked }}></td>
      </tr>
    {% endfor %}
  </table>
{% endset %}

{% set aff_astable %}
  {% for key_as, as_data in asinfo %}
  {% set class %}
    {% if (counter % 2) != 0 %}
      even
    {% endif %}
  {% endset %}
  <li class="li-padding {{ class }}">
    <div class="row">
      <div class="col-lg-2">
        <b><img src="flags/blank.gif" class="flag flag-{{ as_data.info.country|lower }}"/> AS{{ key_as }}: </b><small><i>{{ as_data.info.descr }}</i></small>
        <div class="small">In the last {{ label|default('') }}</div>
        <div class="small">IPv4: ~ {{ as_data.v4.in|format_bytes }} in / {{ as_data.v4.out|format_bytes }} out</div>
        {% if as_data.v6 is defined %}
          <div class="small">IPv6: ~ {{ as_data.v6.in|format_bytes }} in / {{ as_data.v6.out|format_bytes }} out</div>
        {% endif %}
        <span class="small">{{ attribute(customlinks, key_as)|raw }}</span>
        <div class="rank">
          {% set counter = counter + 1 %}
          # {{ counter }}
        </div>
      </div>
      {% if config.showv6 %}
        <div class="col-lg-5">
          <span class="pull-right">
            {{ macro.getHTMLUrl(key_as, 4, as_data.info.descr, start, end, 0, selected_links) }}
          </span>
        </div>
        <div class="col-lg-5">
          <span class="pull-right">
            {{ macro.getHTMLUrl(key_as, 6, as_data.info.descr, start, end, 0, selected_links) }}
          </span>
        </div>
      {% else %}
        <div class="col-lg-10">
          <span class="pull-right">
            {{ macro.getHTMLUrl(key_as, 4, as_data.info.descr, start, end, 0, selected_links) }}
          </span>
        </div>
      {% endif %}
    </div>
  </li>
  {% endfor %}
{% endset %}

{% block content %}
<div class="row">
  <div class="col-md-12 col-lg-{{ first_col }}">
    <div class="row">
      <div class="col-lg-12">
        <div class="row affix col-md-12 col-lg-{{ first_col }}">

          <form method='get'>
            <input type='hidden' name='numhours' value='{{ hours }}'/>
            <input type='hidden' name='n' value='{{ ntop }}'/>
            <div class="box box-primary">
              <div class="box-header with-border">
                <h3 class="box-title">Legend</h3>
              </div>
              <div class="box-body">
                {{ legend }}
              </div>
              <div class="box-footer">
                <button type="submit" class="btn pull-right"><i class="fa fa-search"></i></button>
              </div>
            </div>
          </form>

        </div>
      </div>
    </div>
  </div>

  <div class="col-md-12 col-lg-{{ second_col }} col-lg-offset-{{ offset_second_col }}">
    <div class="row">
      <div class="col-lg-12">
        <div class="box box-primary">
          <div class="box-body">
            <ul class="nav nav-stacked">
              {{ aff_astable }}
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>

</div>


{% endblock %}

{% block modal %}
{% endblock %}

{% block js %}
{% endblock %}
